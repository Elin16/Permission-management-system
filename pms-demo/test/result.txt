/home/fudan/.jdks/corretto-11.0.14.1/bin/java -javaagent:/snap/intellij-idea-ultimate/398/lib/idea_rt.jar=42691:/snap/intellij-idea-ultimate/398/bin -Dfile.encoding=UTF-8 -classpath /home/fudan/Desktop/database/PJtest/pms/out/production/pms-demo:/home/fudan/Desktop/database/PJtest/pms/pms-demo/lib/json-simple-1.1.1.jar:/home/fudan/Desktop/database/PJtest/pms/pms-demo/lib/druid-1.2.9.jar:/home/fudan/Desktop/database/PJtest/pms/pms-demo/lib/commons-lang3-3.12.0.jar:/home/fudan/Desktop/database/PJtest/pms/pms-demo/lib/mysql-connector-j-8.0.31.jar:/home/fudan/Desktop/database/PJtest/pms/pms-demo/lib/opencsv-5.7.0.jar Main
Welcome to Permission Management System!
Dec 20, 2022 10:17:15 PM com.alibaba.druid.pool.DruidDataSource info
INFO: {dataSource-1} inited
Connection established. The connection iscom.mysql.cj.jdbc.ConnectionImpl@4f5991f6
login -t "sa" -u "1"
Please enter your password:
001
Log in success! Your ID is 1
show-stay-oos -u
+-----------+-------+-----+
|         ID|classID|dptID|
+-----------+-------+-----+
|19307090003|      3|    2|
+-----------+-------+-----+
SELECT *
FROM studentBelonging as t
WHERE ID IN(
    SELECT studentID
    FROM (
             SELECT studentID, max(IOTime) as lastOut
             FROM IOLog
             WHERE IOType='out'
             GROUP BY studentID
         ) AS outOfSchool
    WHERE current_timestamp-'24:00:00' > lastOut
)
  AND ID IN (
    (SELECT ID
     FROM student
     WHERE entryPerm > 0 AND inschool=0 AND ID NOT IN(
         SELECT ID
         FROM leaveApplication
         WHERE progress='submitted' OR progress='approved' OR progress='success'
     )
    )
)


show-stay-oos
+-----------+-------+-----+
|         ID|classID|dptID|
+-----------+-------+-----+
|19307090003|      3|    2|
+-----------+-------+-----+
SELECT *
FROM studentBelonging as t
WHERE ID IN(
    SELECT studentID
    FROM (
             SELECT studentID, max(IOTime) as lastOut
             FROM IOLog
             WHERE IOType='out'
             GROUP BY studentID
         ) AS outOfSchool
    WHERE current_timestamp-'24:00:00' > lastOut
)
  AND ID IN (
    (SELECT ID
     FROM student
     WHERE entryPerm > 0 AND inschool=0 AND ID NOT IN(
         SELECT ID
         FROM leaveApplication
         WHERE progress='submitted' OR progress='approved' OR progress='success'
     )
    )
)


show-always-is -d "5"
perm. range is
SUPER_USER
+-----------+-----------+-------+-----+
|         ID|       name|classID|dptID|
+-----------+-----------+-------+-----+
|19307090004|Zhao Miemie|      2|    1|
+-----------+-----------+-------+-----+
SELECT *
FROM (SELECT s.ID, s.name, b.classId, b.dptId
FROM studentBelonging AS b, student AS s
WHERE b.ID=s.ID
AND b.ID IN (
    SELECT studentID
    FROM (
             SELECT studentID, max(IOTime) AS lastIn
             FROM IOLog
             WHERE IOType='in'
             GROUP BY studentID
         ) AS lastInRecord
    WHERE datediff(current_date, DATE(lastIn) ) > 5
AND s.inschool=1))AS t


show-entry-perm
+-----------+---------+
|         ID|entryPerm|
+-----------+---------+
|19307090001|        1|
|19307090002|        1|
|19307090004|        1|
|19307090003|        1|
+-----------+---------+
SELECT student.ID, student.entryPerm
FROM student, studentBelonging as t
WHERE student.ID=t.ID


show-exact-report -d "5"
+--+-------+-----+
|ID|classID|dptID|
+--+-------+-----+
+--+-------+-----+
SELECT *
FROM studentBelonging AS t
WHERE t.ID IN
      (SELECT c.studentID
          FROM  (SELECT h.studentID, MAX(reportTime) as maxT, MIN(reportTime) as minT
                 FROM healthLog as h
                 WHERE datediff(current_date, h.reportDate) < 5
                 GROUP BY h.studentID
                ) AS c
                WHERE c.maxT-'00:01:00' < c.minT)


show-health-report -d "5"
+-----------+----------+----------+---------------+---------------+--------+-----------+-------+-----+
|  studentID|reportDate|reportTime|bodyTemperature|     onLocation|comments|         ID|classID|dptID|
+-----------+----------+----------+---------------+---------------+--------+-----------+-------+-----+
|19307090001|2022-12-16|  00:00:00|           36.7|Quanzhou-Fujian| At home|19307090001|      1|    1|
|19307090001|2022-12-19|  00:00:00|           36.7|Quanzhou-Fujian| At home|19307090001|      1|    1|
|19307090001|2022-12-20|  00:00:00|           36.7|Quanzhou-Fujian| At home|19307090001|      1|    1|
|19307090003|2022-12-20|  01:00:00|           36.7|Quanzhou-Fujian| At home|19307090003|      3|    2|
+-----------+----------+----------+---------------+---------------+--------+-----------+-------+-----+
SELECT *
FROM healthLog, studentBelonging as t
WHERE datediff(curdate(), reportDate) < 5
AND t.ID=studentID


show-leave-is
+-----------+-------+-----+-----------+-----------+--------+---------+--------+-------+-----------------------+------------+------------+-------------+---------------+------------------+------+
|         ID|classID|dptID|         ID|       name|userpass|entryPerm|inSchool|classID|                  email|    domitory|telephoneNum|  homeAddress|  indentityType|      indentityNum|liveIn|
+-----------+-------+-----+-----------+-----------+--------+---------+--------+-------+-----------------------+------------+------------+-------------+---------------+------------------+------+
|19307090001|      1|    1|19307090001|  Li Huahua|   12345|        1|       1|      1|  lihuahua@fudan.edu.cn|south37#1001|   123456789|tangchen1#101|Citizen ID Card|332522200001010001|     H|
|19307090004|      2|    1|19307090004|Zhao Miemie|   12345|        1|       1|      2|zhaomiemie@fudan.edu.cn|south37#5003|   123456780|tangchen1#104|Citizen ID Card|332522200001010004|     H|
+-----------+-------+-----+-----------+-----------+--------+---------+--------+-------+-----------------------+------------+------------+-------------+---------------+------------------+------+
SELECT *
FROM studentBelonging AS t, student AS s
WHERE t.ID=s.ID
AND t.ID IN(
    (
        SELECT studentID
        FROM leaveApplication
        WHERE progress='submitted' OR progress='approved' OR progress='success'
    )
) AND s.inschool=1


show-most-entry-app -n "2" -r "u"
perm. range is u
SUPER_USER
+-----------+-------+-----+------+
|         ID|classID|dptID|amount|
+-----------+-------+-----+------+
|19307090001|      1|    1|     2|
|19307090002|      1|    1|     1|
+-----------+-------+-----+------+
SELECT *
FROM(
   SELECT s.*, COUNT(app.ID) AS amount
   FROM studentBelonging AS s, entryApplication AS app
   WHERE s.ID=app.studentID
   GROUP BY s.ID
   ) AS t
WHERE t.ID=t.ID
   ORDER BY amount DESC
  LIMIT 0,2

show-most-entry-app -n "2" -r "d" -id "2"
perm. range is d
SUPER_USER
+-----------+-------+-----+------+
|         ID|classID|dptID|amount|
+-----------+-------+-----+------+
|19307090003|      3|    2|     1|
+-----------+-------+-----+------+
SELECT *
FROM(
   SELECT s.*, COUNT(app.ID) AS amount
   FROM studentBelonging AS s, entryApplication AS app
   WHERE s.ID=app.studentID
   GROUP BY s.ID
   ) AS t
WHERE t.ID=t.ID
AND t.dptId=2   ORDER BY amount DESC
  LIMIT 0,2

show-most-ios-campus
+-----+----------+
|dptID|campusName|
+-----+----------+
|    1|         H|
|    2|         H|
+-----+----------+
SELECT ranked.dptID, ranked.campusName
FROM(
     SELECT counted.dptID, counted.campusName,
            rank()OVER(PARTITION BY counted.dptID ORDER BY (number) DESC) AS io_rank
     FROM (
          SELECT t.dptID, io.campusName, count(*) AS number
          FROM studentBelonging AS t, IOLog AS io
          WHERE t.ID=io.studentID
          group BY t.dptID, io.campusName
         ) AS counted
     ) AS ranked
WHERE ranked.io_rank=1

show-np-entry-app -d "2"
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
|ID|studentID|applyTime|travelHistoryList|expectEntryTime|reason|progress|refuseReson|ID|classID|dptID|
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
SELECT *
 FROM entryApplication, studentBelonging as t
WHERE  datediff(curdate(), date(applyTime)) < 2
AND entryApplication.studentID=t.ID


show-np-entry-app -d "2" -u
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
|ID|studentID|applyTime|travelHistoryList|expectEntryTime|reason|progress|refuseReson|ID|classID|dptID|
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
+--+---------+---------+-----------------+---------------+------+--------+-----------+--+-------+-----+
SELECT *
 FROM entryApplication, studentBelonging as t
WHERE  datediff(curdate(), date(applyTime)) < 2
AND entryApplication.studentID=t.ID


show-np-leave-app -d "2"
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
|ID|  studentID|          applyTime|    expectLeaveTime|   expectReturnTime|      reason| progress|    destination|refuseReson|         ID|classID|dptID|
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
| 3|19307090004|2022-12-19 22:00:00|2022-12-19 23:32:09|2022-12-18 08:00:00|Go back home|submitted|Quanzhou Fujian|       null|19307090004|      2|    1|
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
SELECT *
 FROM leaveApplication, studentBelonging as t
WHERE  datediff(curdate(), date(applyTime)) < 2
AND leaveApplication.studentID=t.ID


show-np-leave-app -d "2" -u
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
|ID|  studentID|          applyTime|    expectLeaveTime|   expectReturnTime|      reason| progress|    destination|refuseReson|         ID|classID|dptID|
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
| 3|19307090004|2022-12-19 22:00:00|2022-12-19 23:32:09|2022-12-18 08:00:00|Go back home|submitted|Quanzhou Fujian|       null|19307090004|      2|    1|
+--+-----------+-------------------+-------------------+-------------------+------------+---------+---------------+-----------+-----------+-------+-----+
SELECT *
 FROM leaveApplication, studentBelonging as t
WHERE  datediff(curdate(), date(applyTime)) < 2
AND leaveApplication.studentID=t.ID


show-oos
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
|         ID|       name|userpass|entryPerm|inSchool|classID|                 email|    domitory|telephoneNum|  homeAddress|  indentityType|      indentityNum|liveIn|         ID|classID|dptID|
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
|19307090003|Huang Yilin|   12345|        1|       0|      3|huanyilin@fudan.edu.cn|south37#5002|   123456780|tangchen1#103|Citizen ID Card|332522200001010003|     H|19307090003|      3|    2|
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
SELECT *
FROM student, studentBelonging AS t
WHERE student.ID = t.ID AND student.inSchool=0


show-stay-oos
+-----------+-------+-----+
|         ID|classID|dptID|
+-----------+-------+-----+
|19307090003|      3|    2|
+-----------+-------+-----+
SELECT *
FROM studentBelonging as t
WHERE ID IN(
    SELECT studentID
    FROM (
             SELECT studentID, max(IOTime) as lastOut
             FROM IOLog
             WHERE IOType='out'
             GROUP BY studentID
         ) AS outOfSchool
    WHERE current_timestamp-'24:00:00' > lastOut
)
  AND ID IN (
    (SELECT ID
     FROM student
     WHERE entryPerm > 0 AND inschool=0 AND ID NOT IN(
         SELECT ID
         FROM leaveApplication
         WHERE progress='submitted' OR progress='approved' OR progress='success'
     )
    )
)


show-oos -u
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
|         ID|       name|userpass|entryPerm|inSchool|classID|                 email|    domitory|telephoneNum|  homeAddress|  indentityType|      indentityNum|liveIn|         ID|classID|dptID|
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
|19307090003|Huang Yilin|   12345|        1|       0|      3|huanyilin@fudan.edu.cn|south37#5002|   123456780|tangchen1#103|Citizen ID Card|332522200001010003|     H|19307090003|      3|    2|
+-----------+-----------+--------+---------+--------+-------+----------------------+------------+------------+-------------+---------------+------------------+------+-----------+-------+-----+
SELECT *
FROM student, studentBelonging AS t
WHERE student.ID = t.ID AND student.inSchool=0


show-stay-oos -u
+-----------+-------+-----+
|         ID|classID|dptID|
+-----------+-------+-----+
|19307090003|      3|    2|
+-----------+-------+-----+
SELECT *
FROM studentBelonging as t
WHERE ID IN(
    SELECT studentID
    FROM (
             SELECT studentID, max(IOTime) as lastOut
             FROM IOLog
             WHERE IOType='out'
             GROUP BY studentID
         ) AS outOfSchool
    WHERE current_timestamp-'24:00:00' > lastOut
)
  AND ID IN (
    (SELECT ID
     FROM student
     WHERE entryPerm > 0 AND inschool=0 AND ID NOT IN(
         SELECT ID
         FROM leaveApplication
         WHERE progress='submitted' OR progress='approved' OR progress='success'
     )
    )
)



Process finished with exit code 0
